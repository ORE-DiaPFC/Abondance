##-----------------------------DATA ----------------------------------##
# year <- 2015
# site <- "Oir"
# stade <- "adult"

##-----------------------------FUNCTIONS ----------------------------------##
invlogit<-function(x) {1/(1+exp(-(x)))}
logit<-function(x) {log(x/(1-x))}


load(paste('data/data_',stade,"_",year,'.Rdata',sep=""))


for (c in 1:2){ # 2 chains
#------------------------INITS----------------------------------##

###################################################
# NO UPDATE
###################################################
inits_fix <- list(
  # NO UPDATE
  #sigmap_eff = c(0.1,0.2),
  varp_eff = runif(2,0.01,0.05),#c(0.1,0.2)^2,
  shape_lambda = runif(1,2,7),#5,
  rate_lambda = runif(1,.005,0.1),#0.01,
  lambda0=500+runif(1,-10,10),
  mup_recap = runif(4,.1,.7),#c(0.3,0.5,0.3,0.5),     
  #sigmap_recap=c(0.1,0.1,0.2,0.3)   
  varp_recap=runif(4,.005,0.1)#c(0.1,0.1,0.2,0.3)^2
)



###################################################
# TO UPDATE
###################################################
#inits_updated <- list(
# METTRE A JOUR
# lambda=c(
#   500,500,500,500,500,500,500,500,500,500,500,500,500,500,500,500,500,500,500,                        
#   500,500,500,500,500,500,500,500,500,500,500,500,500),
lambda = rep(500, data$Nyears)

# METTRE A JOUR /!\ TAILLE MATRICE
#  annual probability to be captured at Moulin de Cerisel per sea age at logit scale
# logit_pi_eff = structure(.Data = c(         
#   0.5127265, -0.50516446,                    
#   0.2429615, -0.29816470,                    
#   0.4358002, -0.44999789,                    
#   0.4581223, -0.24020537,                    
#   0.4148411, -0.34124070,                    
#   0.4081585, -0.06255602,                    
#   0.3163549, -0.21218071,                    
#   0.3692032, -0.49684217,                    
#   0.5685715, -0.10636175,                    
#   0.4352412, -0.66264032,                    
#   0.3243872, -0.43484468,                    
#   0.5369755, -0.61989005,                    
#   0.4781544, -0.31793986,                    
#   0.4415721, -0.44393003,                    
#   0.5809606, -0.57391739,                    
#   0.4627385, -0.73267519,                    
#   0.5533487, -0.29324114,                    
#   0.6357414, -0.60006038,                    
#   0.4227797, -0.16913003,                    
#   0.2927949, -0.15004335,                    
#   0.3602127, -0.28234524,                    
#   0.3725753, -0.28091169,                    
#   0.3025387, -0.45968826,                    
#   0.2403897, -0.57003221,                    
#   0.4262693, -0.42518736,                    
#   0.2536607, -0.14655583,                    
#   0.5111182, -0.42747081,                    
#   0.4580112, -0.52691562,                    
#   0.4590758, -0.56539226,                    
#   0.4859690, -0.53768309,
#   0.4590758, -0.56539226,                    
#   0.4859690, -0.53768309),                   
#   .Dim = c(32,2)),

logit_pi_eff <- cbind(
  logit( (data$Cm_R[,1]+data$Cm_R[,2]+1) / ((data$Cm_R[,1]+data$Cm_R[,2]+1)+(data$Cum_R[,1]+data$Cum_R[,2]+2)))  ,
  logit( (data$Cm_R[,3]+data$Cm_R[,4]+1) / ((data$Cm_R[,3]+data$Cm_R[,4]+1)+(data$Cum_R[,3]+data$Cum_R[,4]+2))) 
)
#logit_pi_eff <- ifelse(logit_pi_eff=="-Inf",NA,logit_pi_eff)


# METTRE A JOUR /!\ TAILLE MATRICE
# logit_p_recap = structure(.Data = c(                   
#   -0.7899411, -0.119189383,-0.7899411, -0.119189383,     
#   -1.0105426,  0.112161640,-1.0105426,  0.112161640,     
#   -0.6650540,  0.095865979,-0.6650540,  0.095865979,     
#   -0.9352202,  0.153063054,-0.9352202,  0.153063054,     
#   -0.8925006,  0.003701361,-0.8925006,  0.003701361,     
#   -0.7584533,  0.162499740,-0.7584533,  0.162499740,     
#   -0.8783464,  0.015433624,-0.8783464,  0.015433624,     
#   -0.9635229,  0.037277000,-0.9635229,  0.037277000,     
#   -0.7301189,  0.032563762,-0.7301189,  0.032563762,     
#   -0.7242909, -0.203297658,-0.7242909, -0.203297658,     
#   -1.0152822, -0.059872607,-1.0152822, -0.059872607,     
#   -0.8991247, -0.062853404,-0.8991247, -0.062853404,     
#   -0.8910851,  0.148828121,-0.8910851,  0.148828121,     
#   -0.8421063, -0.036137567,-0.8421063, -0.036137567,     
#   -0.8724257, -0.127640120,-0.8724257, -0.127640120,     
#   -0.8241181,  0.081526148,-0.8241181,  0.081526148,     
#   -0.9301552,  0.103002530,-0.9301552,  0.103002530,     
#   -0.9322924,  0.054081970,-0.9322924,  0.054081970,     
#   -0.8599834, -0.002053284,-0.8599834, -0.002053284,     
#   -0.9211022,  0.198061863,-0.9211022,  0.198061863,     
#   -0.8012836,  0.015605389,-0.8012836,  0.015605389,     
#   -0.8367525,  0.020028270,-0.8367525,  0.020028270,     
#   -0.9473647, -0.121825226,-0.9473647, -0.121825226,     
#   -0.7446897,  0.083201546,-0.7446897,  0.083201546,     
#   -0.9311430, -0.088221582,-0.9311430, -0.088221582,     
#   -0.6837008, -0.057448455,-0.6837008, -0.057448455,     
#   -0.8025545,  0.155888834,-0.8025545,  0.155888834,     
#   -0.9052695, -0.038361727,-0.9052695, -0.038361727,     
#   -0.8656477, -0.040313032,-0.8656477, -0.040313032,     
#   -0.9537507,  0.041536211,-0.9537507,  0.041536211,     
#   -0.8656477, -0.040313032,-0.8656477, -0.040313032,     
#   -0.9537507,  0.041536211,-0.9537507,  0.041536211),     
#   .Dim = c(32,4)),  

logit_p_recap = logit((data$Cm_R+1) / (data$C_MC+2))

# METTRE A JOUR /!\ TAILLE MATRICE                                                                                                   
# n=structure(.Data = c(    
#   602,540,505,521,          
#   632,566,517,546,          
#   559,512,530,525,          
#   514,502,500,500,          
#   620,531,512,563,          
#   632,564,518,521,          
#   506,503,502,504,          
#   530,513,501,501,          
#   517,511,501,502,          
#   571,522,504,503,          
#   512,518,500,503,          
#   563,545,500,503,          
#   540,527,500,503,          
#   534,521,500,501,          
#   523,510,500,501,          
#   593,543,505,513,          
#   524,527,501,502,          
#   600,550,504,505,          
#   553,540,507,508,          
#   603,560,501,524,          
#   612,600,506,528,          
#   558,523,502,505,          
#   561,541,500,519,          
#   612,556,501,509,          
#   512,516,501,503,          
#   510,503,500,507,          
#   541,526,500,503,          
#   547,535,502,520,          
#   518,504,503,506,          
#   541,514,504,513,         
#   518,504,503,506,          
#   541,514,504,513),         
#   .Dim = c(32,4)) 

n <- array(,dim=c(data$Nyears,4))
n[,1] = as.integer((data$C_MC[,1]/invlogit(logit_pi_eff[,1])))+ 50
n[,2] = as.integer((data$C_MC[,2]/invlogit(logit_pi_eff[,1])))+ 50
n[,3] = as.integer((data$C_MC[,3]/invlogit(logit_pi_eff[,2])))+ 50
n[,4] = as.integer((data$C_MC[,4]/invlogit(logit_pi_eff[,2])))+ 50

inits_updated <- list(
  lambda = lambda
  ,logit_pi_eff=logit_pi_eff
  ,logit_p_recap=logit_p_recap
  ,n=n
)

inits <- list(c( inits_fix,inits_updated))

#save(inits,file=paste('inits/inits_',stade,year,'.Rdata',sep=""))
#bugs.inits(inits, n.chains=1,digits=3, inits.files = paste('inits/init-',site,'-',stade,year,'.txt',sep=""))
bugs.inits(inits, n.chains=1,digits=3, inits.files = paste('inits/init-',site,'-',stade,year,"_",c,'.txt',sep=""))
} #end loop c

